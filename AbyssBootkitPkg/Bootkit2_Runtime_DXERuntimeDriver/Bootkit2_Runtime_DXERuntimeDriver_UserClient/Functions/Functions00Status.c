// --------------------------------------------------------------------------------------------------------------------------------------------
// --------------------------------------------------------------------------------------------------------------------------------------------



// START -> LIBRARIES -------------------------------------------------------------------------------------------------------------------------
// START -> LIBRARIES -------------------------------------------------------------------------------------------------------------------------



#include <windows.h>
#include <stdio.h>



// START -> LOCAL -----------------------------------------------------------------------------------------------------------------------------
// START -> LOCAL -----------------------------------------------------------------------------------------------------------------------------



#include "Utils/Utils03Communication.h"
#include "../Globals/Globals01Operations.h"
#include "../Structures/Structures00Execution.h"



// START -> FUNCTIONS -------------------------------------------------------------------------------------------------------------------------
// START -> FUNCTIONS -------------------------------------------------------------------------------------------------------------------------



// Verify the DXE Runtime Driver is alive
int FunctionsStatus_CommandPresence()
{
	// -----------------------------------------------------------------------------------------------------------------
	// Buffer where the driver will copy the status string
	char msgBuf[64] = { 0 };


	// -----------------------------------------------------------------------------------------------------------------
	// Request driver presence
	if (!UtilsCommunication_RequestDriverPresence(msgBuf, sizeof(msgBuf)))
	{
		return 1;
	}


	// -----------------------------------------------------------------------------------------------------------------
	// Show response
	wprintf(L"[+] Driver response: '%S'\n", msgBuf);


	// -----------------------------------------------------------------------------------------------------------------
	// Return
	return 0;
}




// Retrieve start/end addresses of DXE buffer
int FunctionsStatus_CommandBufferInfo()
{
	// ---------------------------------------------------------------------------------------------------------------------
	// Variables
	ULONGLONG bufferStart = 0;
	ULONGLONG bufferEnd = 0;


	// ---------------------------------------------------------------------------------------------------------------------
	// Request get buffer bounds
	if (!UtilsCommunication_RequestGetBufferBounds(&bufferStart, &bufferEnd))
	{
		return 1;
	}


	// ---------------------------------------------------------------------------------------------------------------------
	// Addresses
	wprintf(L"[+] Buffer Start: 0x%llx\n", bufferStart);
	wprintf(L"[+] Buffer End:   0x%llx\n", bufferEnd);


	// ---------------------------------------------------------------------------------------------------------------------
	// Return
	return 0;
}



// --------------------------------------------------------------------------------------------------------------------------------------------
// --------------------------------------------------------------------------------------------------------------------------------------------
